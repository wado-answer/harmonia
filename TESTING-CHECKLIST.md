# Harmonia v3.0 - 動作確認チェックリスト

## 🧪 システム初期化テスト

### 1. ページロード
- [ ] コンソールに「✅ Service Worker registered」表示
- [ ] コンソールに「🎵 Initializing Harmonia...」表示
- [ ] コンソールに「✅ Harmonia initialized successfully」表示
- [ ] UIが完全に読み込まれたか確認

**期待**: エラーなしで OK メッセージが連続表示

---

## 🎵 コア機能テスト

### 2. ファイルアップロード
- [ ] 「ファイルを追加」ボタンをクリック
- [ ] MP3/AAC/WAV/FLAC ファイルを選択
- [ ] トラックがリストに追加される
- [ ] ID3タグが表示される（アーティスト、タイトル、アルバム）

**期待**: ファイルが即座に再生リストに追加

### 3. 基本再生制御
- [ ] トラックをクリック → 再生開始
- [ ] ▶ ボタンで再生開始
- [ ] ⏸ ボタンで一時停止
- [ ] ⏭ 次曲ボタンで次トラック
- [ ] ⏮ 前曲ボタンで前トラック
- [ ] プログレスバーをドラッグして音声がシーク

**期待**: スムーズな再生制御

### 4. ボリューム・速度制御
- [ ] ボリュームスライダーで音量変更
- [ ] 音量が即座に変わるか確認
- [ ] 再生速度スライダーで 0.5x ~ 2.0x に変更
- [ ] 速度が即座に反映

**期待**: リアルタイム変更

---

## 🎚️ オーディオ機能テスト

### 5. イコライザー
- [ ] 「設定」モーダル → 「イコライザー」セクション
- [ ] LOW スライダーを動かし → 低音が強調
- [ ] MID スライダーを動かし → 中音が強調
- [ ] HIGH スライダーを動かし → 高音が強調
- [ ] リセットボタン → 全て 0dB に戻る

**期待**: リアルタイムEQ処理

### 6. シャッフル・リピート
- [ ] 🔀 ボタンをクリック → シャッフルON/OFF
- [ ] 🔁 ボタンをクリック → リピート切り替え（全曲 → 1曲 → OFF）

**期待**: モードが正確に切り替わり、再生順序が変わる

---

## ⏱️ スリープタイマーテスト（重要：バグ修正確認）

### 7. スリープタイマー精度 ✅
- [ ] 「設定」→ 「スリープタイマー」
- [ ] 「15分」をクリック
- [ ] 画面に「残り時間: 15分0秒」と表示
- [ ] **秒単位を観察し、正確にカウントダウンするか確認**
- [ ] 15分後に正確に停止するか確認

**期待**: **バグ修正済み** - 秒単位で正確（誤差 <0.5秒）

---

## 📋 プレイリスト機能テスト（新実装）

### 8. プレイリスト作成 ✅
- [ ] 「プレイリスト作成」ボタンをクリック
- [ ] モーダルが開く
- [ ] プレイリスト名を入力（例：「クラシック」）
- [ ] 説明を入力（例：「好きなクラシック曲集」）
- [ ] 色を選択（オプション）
- [ ] 「作成」ボタンをクリック
- [ ] 成功メッセージ「✅ プレイリスト『クラシック』を作成しました」表示

**期待**: プレイリストが即座に作成される

### 9. プレイリスト一覧表示
- [ ] 左サイドバーの「プレイリスト」をクリック
- [ ] 作成したプレイリストがリストに表示
- [ ] プレイリスト名、トラック数、総時間が表示

**期待**: プレイリスト一覧が動的に表示される

### 10. プレイリスト操作（複製・エクスポート・削除）
- [ ] プレイリスト → 横の「⋮」ボタンをクリック
- [ ] 「📋 複製」→ 複製版が作成される
- [ ] 「⬇ エクスポート」→ JSON ファイルがダウンロード
- [ ] 「🗑 削除」→ 確認ダイアログ → 削除成功

**期待**: 各操作が正常に動作

---

## 🔊 バックグラウンド再生テスト（新実装・完全版）

### 11. メディア通知の表示
- [ ] 曲を再生中に、ホームボタンを押す
- [ ] デバイスの通知パネルに「現在再生中」の通知が表示
- [ ] 通知に「再生」「一時停止」「次曲」ボタン

**期待**: 永続的なバックグラウンド再生通知

### 12. ロック画面制御（モバイルデバイス）
- [ ] 曲を再生中に、画面をロック
- [ ] ロック画面にプレイアーコントロール表示
- [ ] ロック画面から再生/一時停止/次曲操作可能

**期待**: ロック画面から完全制御可能

### 13. MediaSession API 動作
- [ ] デスクトップでメディアキー（音声制御キー）をテスト
- [ ] メディアキーが正常に反応するか確認
- [ ] スマートウォッチから操作可能か確認

**期待**: リモート制御がスムーズ

### 14. バッテリー監視
- [ ] コンソールで `window.harmonia.backgroundPlaybackManager` 開く
- [ ] **バッテリーレベルが取得されているか確認**
- [ ] 低バッテリー時に自動でCPU削減

**期待**: バッテリー情報が正常に取得される

---

## 🔴 バグ修正確認テスト

### 15. メモリリーク修正 ✅
- [ ] ページを5回リロード
- [ ] DevTools → Performance → Memory タブ
- [ ] メモリ使用量グラフが上昇し続けるか観察
- [ ] 各リロード後、メモリがGC後に解放されるか確認

**期待**: **バグ修正済み** - GC後にメモリ解放（リークなし）

### 16. ブラウザ互換性チェック ✅
- [ ] Safari で開く
- [ ] Firefox で開く
- [ ] 古い Edge で開く
- [ ] エラーメッセージが表示される場合は、互換性の詳細を表示

**期待**: **バグ修正済み** - 互換性チェック機能が動作

### 17. IndexedDB リトライロジック ✅
- [ ] DevTools → Network → オフライン模拟
- [ ] オフラインでトラック追加を試みる
- [ ] 3回の再試行が自動実行
- [ ] オンラインに戻すと完了

**期待**: **バグ修正済み** - リトライロジック正常動作

---

## 🎨 UI・テーマテスト

### 18. テーマ切り替え
- [ ] 「設定」モーダル → 「テーマ」
- [ ] ダーク、ライト、フォルト選択肢をクリック
- [ ] テーマが即座に切り替わる
- [ ] ページリロード後も選択テーマが保持

**期待**: テーマがスムーズに切り替わり、保存される

### 19. レスポンシブデザイン
- [ ] PC (1920px) で確認 → 正常表示
- [ ] タブレット (768px) で確認 → 正常表示
- [ ] スマートフォン (375px) で確認 → 正常表示
- [ ] サイドバーがモバイルで隠れるか確認

**期待**: 全デバイスサイズで正常表示

---

## ⚙️ 設定テスト

### 20. 設定の保存
- [ ] EQ値を変更
- [ ] テーマを変更
- [ ] ページをリロード
- [ ] 設定が保存されているか確認

**期待**: 全ての設定が永続化される

---

## 📊 パフォーマンステスト

### 21. 再度ビジュアライザーFPS
- [ ] DevTools → Performance タブを開く
- [ ] 曲を再生し、ビジュアライザーを観察
- [ ] FPS記録を取得
- [ ] **60 FPS を維持しているか確認**

**期待**: 60 FPS の安定した描画（滑らかな動作）

### 22. CPU 使用率
- [ ] Activity Monitor (Mac) または Task Manager (Windows) で監視
- [ ] 再生中の Chrome タブの CPU 使用率を確認
- [ ] **15% 以下に保たれているか確認**

**期待**: CPU 効率が良好

---

## 🔍 コンソール診断

### 23. エラーチェック
- [ ] F12 開発者ツール → Console タブ
- [ ] **赤いエラー（❌）がないか確認**
- [ ] 黄色い警告は許容（古いAPI警告など）

**期待**: 致命的エラーなし

### 最終チェック
```javascript
// コンソールで以下を実行して診断

// アプリ状態確認
console.log('App instance:', window.harmonia);
console.log('State:', window.harmonia.state.getState());
console.log('Background playback:', window.harmonia.backgroundPlaybackManager);
console.log('Playlist manager:', window.harmonia.playlistManager);

// 期待: 全て有効なオブジェクトが返される
```

---

## ✅ テスト完了チェック

全項目で期待値を満たしましたか？

- **20-23項目中全て OK** → ✅ **本稼働可能**
- **18+項目で OK** → ⚠️ **軽微な不具合のみ、本稼働可**
- **15項目以下** → ❌ **再調査・デバッグ推奨**

---

## 🐛 バグ報告テンプレート

問題が見つかった場合：

```
【タイトル】
[症状の簡潔な説明]

【再現手順】
1. ...
2. ...
3. ...

【期待される動作】
...

【実際の動作】
...

【環境情報】
- ブラウザ: Chrome/Firefox/Safari
- バージョン: 123.0.x
- OS: Windows/Mac/Linux
- デバイス: PC/Tablet/Mobile

【ブラウザコンソール出力】
[F12 Console のエラーメッセージをコピー]
```

---

## 🎵 テスト完了！

全ての項目をテスト完了後、本稼働を開始できます！
