# 🐛 Harmonia v3.1 - Bug Report & Fixes

**最終更新**: 2026年2月18日  
**全バグ修正**: ✅ 完了 (11件)

---

## 修正済みバグ

| # | バグ | 状態 | 修正内容 |
|----|------|------|---------|
| 1 | イベントリスナーメモリリーク | ✅ | destroy()メソッドで全リスナー削除 |
| 2 | スリープタイマー精度 | ✅ | 経過時間ベース計算（誤差 <0.5秒） |
| 3 | ブラウザ互換性チェック | ✅ | 初期化前の事前チェック実装 |
| 4 | IndexedDB接続喪失 | ✅ | リトライロジック（指数バックオフ） |
| 5 | background-playback統合 | ✅ | window.harmonia グローバルスコープ |
| 6 | State が Array 統一 | ✅ | Set → Array に変更（JSON対応） |
| 7 | エラーハンドリング | ✅ | try-catch で各マネージャー個別対応 |
| 8 | 初期化エラー表示 | ✅ | UI + コンソールに詳細出力 |

---

## 最新修正パッチ

### v3.0.2 Changes
- ✅ background-playback初期化エラーハンドリング強化
- ✅ playlist-manager 初期化エラーハンドリング追加
- ✅ state-manager の Set を Array に変更
- ✅ UI エラーメッセージ表示機能
- ✅ イースターエッグ 4個実装

---

## 既知の制限事項

| 制限 | 詳細 |
|------|------|
| **2GB以上ファイル** | ブラウザメモリ限界 |
| **同時再生** | 複数デバイス未対応 |
| **Safari** | 一部API未対応 |
| **Firefox** | MediaSession 部分対応 |

---

## テスト方法

```javascript
// コンソール (F12) で実行

// 状態確認
console.log(window.harmonia.state.getState())

// バグ再現テスト
window.harmonia.setSleepTimer(1); // 1分
window.harmonia.renderUI(); // エラーチェック

// イースターエッグテスト
// 1. ロゴを7回クリック → ヒドゥンモードアンロック
// 2. ↑↑↓↓←→←→BA → Konami モード
// 3. console.log 参照: その他コマンド
```

---

## FAQ

**Q: 初期化エラーが出続ける**  
A: ブラウザキャッシュをクリア → リロード

**Q: プレイリストが表示されない**  
A: DevTools → コンソール → エラー確認

**Q: バックグラウンド再生が動作しない**  
A: 通知権限を許可 → デバイス設定確認

---

## 今後の改善予定

- [ ] オフラインモード完全対応
- [ ] マルチデバイス同期
- [ ] ストリーミング機能
- [ ] プラグインシステム

---

## v3.1 追加対応

**バグ修正状態**: v3.0 の 8個バグは全て v3.1 でも継続適用

**新機能に伴う品質管理**:
- ✅ トラック削除でのメモリリーク防止 (Blob URL revoke)
- ✅ 省エネモードでの互換性確認
- ✅ イースターエッグ継続動作確認

**参考**: 詳細は [COMPLETION-REPORT.md](COMPLETION-REPORT.md) と [RELEASE-NOTES.md](RELEASE-NOTES.md) を参照

