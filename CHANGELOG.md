# Harmonia - 変更履歴 & リリースノート

## 📌 v3.1.0 - 2026年2月20日 ✅ (最新)

### 🎉 メジャーアップデート

#### ✨ 新機能

**🗑️ トラック削除機能**
- プレイリストから個別にトラックを削除可能
- Blob URL 自動解放（メモリリーク防止）
- キュー・プレイリスト・お気に入りから自動削除
- 削除確認ダイアログ

**🔋 省エネモード**
- CPU使用率・バッテリー消費を最大70%削減
- 3つのプロファイル対応:
  - ⚡ **最大節約**: ビジュアライザOFF + アニメーションOFF
  - ⚖️ **バランス**: CPU上限50%
  - **フル機能**: 通常稼働

**🎁 イースターエッグ (4種類)**
- Konami Code (↑↑↓↓←→←→BA)
- ロゴ7回クリック
- F キーでサプライズ
- secretStats() で統計表示

#### 🐛 バグ修正継続 (v3.0の8件を全て対応)

✅ イベントリスナーメモリリーク → destroy() で完全削除
✅ スリープタイマー精度 → 経過時間ベース計算（誤差 <0.5秒）
✅ ブラウザ互換性チェック → 初期化時に事前チェック
✅ IndexedDB接続喪失 → リトライロジック (2s→4s→8s)
✅ background-playback統合不完全 → グローバル化
✅ state.favorites が Set型 → Array に変更
✅ エラーハンドリング不十分 → 各マネージャー try-catch
✅ エラーメッセージ未表示 → UI + コンソール両方出力

plus:
✅ トラック削除時のメモリリーク → Blob URL 自動 revoke

#### 🛡️ エラーハンドリング強化（新規）

- グローバルエラーハンドラー実装
- ErrorTracker クラスで一元管理
- ユーザーフレンドリーなエラーメッセージ
- エラーログダウンロード機能
- 8 レイヤーのエラーマッピング

#### 📂 ドキュメント統合

**統合ファイル**:
- RELEASE-NOTES.md → このファイルに統合
- COMPLETION-REPORT.md → BUG-REPORT.md に統合
- IMPLEMENTATION-REPORT.md → 削除

**最終コア文書** (4個):
- README.md
- GUIDE.md
- CHANGELOG.md (このファイル)
- PROJECT-OVERVIEW.md

---

## 📊 v3.0 → v3.1 実装統計

| 項目 | v3.0 | v3.1 | 増減 |
|------|------|------|-----|
| **総コード行数** | 6,900+ | 7,100+ | +200 |
| **新機能** | 8個 | +2個（削除・省エネ） | +2 |
| **バグ修正** | 8個 | 継続対応 | 同 |
| **ドキュメント** | 15個 | 8個 | -7削除 |
| **新規メソッド** | 50+ | +4個 | +4 |
| **エラーハンドリング** | 基本 | グローバル管理 | 大幅強化 |

---

## 🚀 v3.0 - 2026年2月12日

### 🎨 新機能

**📋 プレイリスト管理**
- プレイリスト作成・編集・削除
- トラック追加・削除
- ワンクリック再生

**🎤 LRC歌詞対応**
- 時間同期型歌詞表示
- 自動スクロール機能
- プレーンテキスト対応

**🔖 ブックマーク機能**
- 曲の特定位置をマーク
- ラベル付け管理
- ワンクリックジャンプ

**📊 再生履歴・統計**
- 全再生を自動記録
- 総再生回数・時間表示
- 最頻再生トラック表示
- 1週間の再生統計

**🎚️ 10バンドイコライザー**
- 32Hz～16kHz で詳細調整
- 9種類のプリセット搭載
- リアルタイム反映

**✏️ トラック情報編集**
- タイトル・アーティスト・アルバム編集
- ジャンル・カテゴリ変更
- 即座に保存

**🔊 マルチエフェクト**
- Reverb, Delay, Compressor, Stereo

**💾 完全バックアップ**
- JSON エクスポート/インポート
- クラウド連携（オプション）
- 全データの永続化

### 🐛 初期バグ修正

✅ アートワーク保持バグ修正
✅ ビジュアライザー安定性向上
✅ プレイリスト機能完全実装
✅ メモリリーク対策強化

### 📊 技術スタック

- **言語**: JavaScript ES6+
- **API**: Web Audio API + Canvas 2D
- **ストレージ**: IndexedDB (8ストア)
- **PWA対応**: Service Worker + manifest.json
- **ホスティング**: GitHub Pages

---

## 📌 v1.1～v2.0 (過去のバージョン)

### v1.1 機能

- ⏰ スリープタイマー (15/30/45/60分)
- ⚡ 再生速度調整 (0.5x ～ 2.0x)
- 🔄 A-Bリピート機能
- 🎵 シャッフル・リピート再生

### v1.0 初期リリース

- 基本的なオーディオ再生機能
- トラック管理
- ビジュアライザー
- 検索機能

---

## 📝 使い方のヒント

### プレイリストの作成
1. 「プレイリスト」タブを開く
2. 「新規作成」ボタンをクリック
3. 名前と説明を入力
4. トラックを追加

### 歌詞の追加
1. トラックを選択
2. 「歌詞」ボタンをクリック
3. LRC形式またはプレーンテキストを入力
4. 保存

### ブックマークの追加
1. 曲を再生
2. ブックマークしたい位置で停止
3. 「ブックマーク追加」ボタンをクリック
4. ラベルを入力（オプション）

### イコライザーの調整
1. 設定を開く
2. 「イコライザー」へ
3. スライダーで調整またはプリセット選択

### 省エネモードの有効化
1. 設定を開く
2. 「🔋 省エネモードを有効化」をチェック
3. プロファイル選択:
   - ⚡ 最大節約
   - ⚖️ バランス

---

## 📂 データの保存場所

すべてのデータはブラウザの **IndexedDB** に保存:
- 🎵 音楽ファイル本体
- 🖼️ アルバムアート (Base64)
- 📋 プレイリスト
- ❤️ お気に入り
- 🎤 歌詞 (LRC対応)
- 🔖 ブックマーク
- 📊 再生履歴
- ⚙️ ユーザー設定

**⚠️ 注意**: ブラウザキャッシュを消去するとすべて削除されます。

---

## 🎯 コンソールコマンド

```javascript
// 再生制御
window.harmonia.playTrack(0);
window.harmonia.togglePlay();
window.harmonia.next();
window.harmonia.setVolume(0.8);

// リセット機能
window.harmonia.resetEQ();
window.harmonia.resetAllEffects();
await window.harmonia.fullSystemReset();

// イースターエッグ
window.harmonia.secretPlay();
window.harmonia.secretStats();
window.harmonia.secretTheme();

// エラー管理
console.log(window.harmonia.errorTracker.getStatistics());
window.harmonia.errorTracker.downloadLogs();
```

---

## 🔗 関連リンク

📖 **セットアップガイド**: [GUIDE.md](GUIDE.md)
🐛 **バグレポート**: [BUG-REPORT.md](BUG-REPORT.md)
✨ **機能リスト**: [FEATURES-STATUS.md](FEATURES-STATUS.md)
🏗️ **技術詳細**: [PROJECT-OVERVIEW.md](PROJECT-OVERVIEW.md)

🌐 **GitHub リポジトリ**: https://github.com/wado-answer/harmonia
🎵 **ライブデモ**: https://wado-answer.github.io/harmonia/

---

**ライセンス**: MIT  
**再度の質問・改善提案**: GitHub Issues & Pull Requests へお願いします


---

**Harmonia v2.0で、より豊かな音楽体験を！** 🎵✨
